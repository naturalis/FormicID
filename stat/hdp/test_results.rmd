---
title: "Test results"
author: "MarijnJABoer"
date: "29/05/2018"
output:
  md_document:
    variant: markdown_github
    toc: true
    fig_width: 7
    fig_height: 6
---

```{r Setup, echo=T, message=FALSE, warning=FALSE, results='hide'}
setwd("~/Internships/Internship CNN 2017-2018/FormicID/stat/hdp")
library(ggplot2)
library(cowplot)
library(reshape2)
library(gridExtra)
library(plyr)
```

```{r}
data <- read.csv("testresults.csv", header = 1, sep = ";")
data$diff <- data$Test_top_3 - data$Test_top_1
data <- data[, c(1, 2, 4, 5)]
names(data) <- c("Experiment", "Top 1", "Shottype", "Top 3")
# data <- melt(data[1:3])
# names(data) <- c("Experiment", "Category", "Percentage")
# data$Category <- relevel(data$Category, 'Test top 3')

unclean <- data[c(1,4,7), ]
unclean <- melt(unclean, value.name = "Percentage")
unclean <- ddply(unclean, "Shottype",
                   transform, label_ypos=cumsum(Percentage))
clean <- data[c(2, 5, 8), ]
clean <- melt(clean, value.name = "Percentage")
clean <- ddply(clean, "Shottype",
                   transform, label_ypos=cumsum(Percentage))
best <- data[c(3, 6, 9), ]
best <- melt(best, value.name = "Percentage")
best <- ddply(best, "Shottype",
                   transform, label_ypos=cumsum(Percentage))
statia <- data[c(10,13,14), ]
statia <- melt(statia, value.name = "Percentage")
statia <- ddply(statia, "Shottype",
                   transform, label_ypos=cumsum(Percentage))
workers <- data[c(11,12,15), ]
workers <- melt(workers, value.name = "Percentage")
workers <- ddply(workers, "Shottype",
                   transform, label_ypos=cumsum(Percentage))

```

```{r}
brks <- c(0.0, 0.25, 0.50, 0.75, 1.0)
```


```{r}
p1 <-
    ggplot(unclean, aes(x = Shottype, y = Percentage, fill = variable)) +
    geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
    geom_text(
        aes(y = label_ypos, label = label_ypos),
        vjust = 1.6,
        color = "white"
    ) +
    scale_y_continuous(breaks = brks, limits = c(0, 1)) +
    theme(axis.text.x = element_text(angle = 0.65, vjust = 0.6),
          legend.title = element_blank()) +
    ggtitle("Unclean") +
    xlab(NULL) +
    ylab("Accuracy")
legend_t <- get_legend(p1)
```
    
```{r}
p2 <-
    ggplot(clean, aes(x = Shottype, y = Percentage, fill = variable)) +
    geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
    geom_text(
        aes(y = label_ypos, label = label_ypos),
        vjust = 1.6,
        color = "white"
    ) +
    scale_y_continuous(breaks = brks, limits = c(0, 1)) +
    theme(axis.text.x = element_text(angle = 0.65, vjust = 0.6)) +
    ggtitle("Clean") +
    xlab(NULL) +
    ylab(NULL)
```

```{r}
p3 <-
    ggplot(best, aes(x = Shottype, y = Percentage, fill = variable)) +
    geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
    geom_text(
        aes(y = label_ypos, label = label_ypos),
        vjust = 1.6,
        color = "white"
    ) +
    scale_y_continuous(breaks = brks, limits = c(0, 1)) +
    theme(axis.text.x = element_text(angle = 0.65, vjust = 0.6)) +
    ggtitle("Best (clean)") +
    xlab(NULL) +
    ylab(NULL)
```

```{r}
p4 <-
    ggplot(statia, aes(x = Shottype, y = Percentage, fill = variable)) +
    geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
    geom_text(
        aes(y = label_ypos, label = sprintf("%0.4f", label_ypos)),
        vjust = 1.6,
        color = "white"
    ) +
    scale_y_continuous(breaks = brks, limits = c(0, 1)) +
    theme(axis.text.x = element_text(angle = 0.65, vjust = 0.6)) +
    ggtitle("St. Eustatius collection") +
    xlab(NULL) +
    ylab(NULL)
```

```{r}
p5 <-
    ggplot(workers, aes(x = Shottype, y = Percentage, fill = variable)) +
    geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
    geom_text(
        aes(y = label_ypos, label = sprintf("%0.4f", label_ypos)),
        vjust = 1.6,
        color = "white"
    ) +
    scale_y_continuous(breaks = brks, limits = c(0, 1)) +
    theme(axis.text.x = element_text(angle = 0.65, vjust = 0.6)) +
    ggtitle("Workers only") +
    xlab(NULL) +
    ylab(NULL)
```


```{r}
plots <- plot_grid(
    p1 + theme(legend.position = "none"),
    p2 + theme(legend.position = "none"),
    p3 + theme(legend.position = "none"),
    p5 + theme(legend.position = "none"),
    p4 + theme(legend.position = "none"),
    ncol = 5,
    nrow = 1,
    align = "h",
    labels = c("AUTO")
)
prefinal <- plot_grid(plots, legend_t, rel_widths = c(5, .45))
title <-
    ggdraw() + draw_label("Test accuracy (top 1 and top 3)",
                          size = 18,
                          fontface = 'bold')
final <- plot_grid(title,
                   prefinal,
                   ncol = 1,
                   rel_heights = c(0.1, 1))
final
```


```{r}
save_plot("testresults3.pdf",
          final,
          base_width = 15,
          base_height = 5)
```

